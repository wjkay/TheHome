http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 127.0.0.1
    - 192.168.0.203

# Loads default set of integrations. Do not remove.
# default_config:
api:

zha:
  custom_quirks_path: /config/zhaquirks
# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Toast energy pricing - fixed night rate 9pm to 7am
template:
  - sensor:
      - name: "Toast Pricing Period"
        unique_id: toast_pricing_period
        state: >
          {% set hour = now().hour %}
          {% if 21 <= hour or hour < 7 %}
            Off-Peak
          {% else %}
            Peak
          {% endif %}
        icon: >
          {% if 21 <= now().hour or now().hour < 7 %}
            mdi:weather-night
          {% else %}
            mdi:weather-sunny
          {% endif %}

cover:
  - platform: template
    covers:
      garage_door:
        friendly_name: "Garage Door"
        unique_id: cover_garage_door
        device_class: garage
        value_template: >
          {% if is_state('binary_sensor.garage_door_opening', 'on') %}
            open
          {% else %}
            closed
          {% endif %}
        open_cover:
          service: light.turn_on
          data:
            entity_id: light.garage_door
        close_cover:
          service: light.turn_off
          data:
            entity_id: light.garage_door
        stop_cover:
          service: light.toggle
          data:
            entity_id: light.garage_door

rest_command:
  whisper_tts:
    url: "http://192.168.0.225:5000/generate_speech"
    method: POST
    headers:
      Content-Type: application/json
    payload: '{"message": "{{ message }}"}'

input_select:
  traffic_cam_timeline:
    name: Traffic Cam Timeline
    options:
      - 15min
      - 1hr
      - 4hr
    initial: 15min
    icon: mdi:clock

input_boolean:
  ev_charge_override:
    name: EV Charge Override
    icon: mdi:car-electric

input_number:
  ev_charge_start_soc:
    name: EV Charge Start SOC
    min: 0
    max: 100
    step: 0.1
    unit_of_measurement: "%"
    icon: mdi:battery-charging

counter:
  baby_wakeups:
    name: Baby Wake-ups Tonight
    initial: 0
    step: 1
    icon: mdi:baby-face-outline

# homeassistant:
#   allowlist_external_dirs:
#     - "/config/www/traffic_cams"  # Uncomment when directory exists